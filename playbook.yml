---
- name: My Ansible Playbook
  become: true
  gather_facts: false
  hosts: localhost
  vars:
    ansible_sudo_pass: "72485031"
    repo_url: "https://github.com/Remi-Mergen/whanos_python.git"
    repo_path: "/home/{{ ansible_user }}/whanos_repository"
  tasks:
    - name: "Check docker installation"
      block:
        - name: Debug
          ansible.builtin.debug:
            msg: "Installing Docker"
          tags: docker

        - name: Install Docker
          ansible.builtin.apt:
            name: docker.io
            state: present
          tags: docker

        - name: Pull the docker images
          ansible.builtin.shell: docker pull {{ item }}
          with_items:
            - registry
          tags: docker

    - name: "Install Jenkins"
      block:
        - name: Debug
          ansible.builtin.debug:
            msg: "Installing Jenkins"
          tags: jenkins

        - name: Add the Jenkins repository key
          ansible.builtin.apt_key:
            url: https://pkg.jenkins.io/debian-stable/jenkins.io.key
            state: present
          tags: jenkins

        - name: Add the Jenkins repository
          ansible.builtin.apt_repository:
            repo: deb https://pkg.jenkins.io/debian-stable binary/
            state: present
          tags: jenkins

        - name: Install Jenkins
          ansible.builtin.apt:
            name: jenkins
            state: present
          tags: jenkins

        - name: Start Jenkins
          ansible.builtin.service:
            name: jenkins
            state: started
            enabled: true
          tags: jenkins
